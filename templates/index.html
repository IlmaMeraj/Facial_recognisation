<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>EmoTrack - Emotion AI</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        color: white;
        font-family: "Segoe UI";
        min-height: 100vh;
      }

      /* HERO */
      .hero-section {
        text-align: center;
        padding: 60px 20px 30px;
      }

      .hero-title {
        font-size: 56px;
        font-weight: 800;
        background: linear-gradient(90deg, #00e5ff, #00c6ff, #0072ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .hero-tag {
        display: inline-block;
        margin-top: 20px;
        padding: 8px 22px;
        border-radius: 50px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      /* MAIN CARD */
      .main-card {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(15px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      }

      /* UPLOAD BOX */
      .upload-box {
        border: 2px dashed rgba(255, 255, 255, 0.3);
        border-radius: 20px;
        padding: 35px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.05);
      }

      .upload-box:hover {
        border-color: #00e5ff;
        box-shadow: 0 0 25px rgba(0, 229, 255, 0.2);
        transform: translateY(-3px);
      }

      .upload-icon {
        font-size: 40px;
        color: #00e5ff;
      }

      .upload-text {
        margin-top: 10px;
        opacity: 0.9;
      }

      .file-name {
        margin-top: 10px;
        color: #00e5ff;
      }

      .preview-img {
        margin-top: 15px;
        max-width: 200px;
        border-radius: 12px;
        display: none;
      }

      /* BUTTON */
      .btn-custom {
        background: linear-gradient(45deg, #00c6ff, #0072ff);
        border: none;
        color: white;
        font-weight: 600;
      }

      /* RESULT */
      .result-box {
        font-size: 28px;
        font-weight: bold;
        margin-top: 15px;
        color: #00e5ff;
      }

      video {
        border-radius: 15px;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
      }

      .loader {
        display: none;
        border: 6px solid #f3f3f3;
        border-top: 6px solid #00e5ff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <div class="container py-4">
      <!-- HERO -->
      <div class="hero-section">
        <h1 class="hero-title">EmoTrack</h1>
        <div class="hero-tag">Real-Time Facial Emotion Detector</div>
      </div>

      <!-- CARD -->
      <div class="main-card">
        <h4 class="text-center mb-4">Upload Face Image</h4>

        <form
          action="/predict"
          method="POST"
          enctype="multipart/form-data"
          class="text-center"
        >
          <label class="upload-box w-100" id="uploadBox">
            <div class="upload-icon">ðŸ“¤</div>
            <div class="upload-text">Drag & Drop Image or Click to Upload</div>

            <input
              type="file"
              name="image"
              id="fileInput"
              hidden
              accept="image/*"
            />

            <div class="file-name" id="fileName"></div>

            <img id="previewImage" class="preview-img" />
          </label>

          <button class="btn btn-custom w-100 mt-4">Predict Emotion</button>
        </form>

        <hr class="my-4" />

        <h4 class="text-center">Live Webcam Detection</h4>

        <div class="text-center">
          <video id="webcam" width="420" autoplay></video><br />

          <button id="capture-btn" class="btn btn-success mt-3 w-50">
            Capture & Predict
          </button>

          <div class="loader mt-3" id="loader"></div>

          <div class="result-box">
            <span id="predicted-emotion">
              {{ emotion if emotion else "" }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <script>
      /* WEBCAM */
      const webcam = document.getElementById("webcam");
      const captureBtn = document.getElementById("capture-btn");
      const canvas = document.createElement("canvas");
      const loader = document.getElementById("loader");
      const result = document.getElementById("predicted-emotion");

      navigator.mediaDevices
        .getUserMedia({ video: true })
        .then((stream) => (webcam.srcObject = stream));

      captureBtn.onclick = () => {
        loader.style.display = "block";

        canvas.width = webcam.videoWidth;
        canvas.height = webcam.videoHeight;

        canvas.getContext("2d").drawImage(webcam, 0, 0);

        const imageData = canvas.toDataURL("image/jpeg");

        fetch("/predict-webcam", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ image: imageData }),
        })
          .then((res) => res.json())
          .then((data) => {
            loader.style.display = "none";
            result.innerText = data.emotion;
          });
      };

      /* UPLOAD UI */
      const fileInput = document.getElementById("fileInput");
      const fileName = document.getElementById("fileName");
      const preview = document.getElementById("previewImage");
      const uploadBox = document.getElementById("uploadBox");

      fileInput.addEventListener("change", showFile);

      uploadBox.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadBox.style.borderColor = "#00e5ff";
      });

      uploadBox.addEventListener("dragleave", () => {
        uploadBox.style.borderColor = "rgba(255,255,255,0.3)";
      });

      uploadBox.addEventListener("drop", (e) => {
        e.preventDefault();
        fileInput.files = e.dataTransfer.files;
        showFile();
      });

      function showFile() {
        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];

          fileName.innerText = "Selected: " + file.name;

          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
            preview.style.display = "block";
          };
          reader.readAsDataURL(file);
        }
      }
    </script>
  </body>
</html>
